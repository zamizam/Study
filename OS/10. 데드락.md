# 데드락(DeadLock)
교착 상태라고도 하며, 두 개 이상의 프로세스들이 서로 가진 자원을 기다리며 중단된 상태를 말한다. 

> 즉, 둘 이상의 프로세스가 남이 가진 자원을 서로 요구하면서 양쪽 모두 작업 수행을 할 수 없어 중단(Blocked or 대기(Wait)) 상태로 놓이는 상태를 말한다.

데드락은 다중 프로그래밍 시스템에서 일어날 수 있는 현상이다.

예를 들면, 프린터를 사용하고 있는 프로세스 A와 디스크를 사용하고 있는 프로세스 B가 서로의 자원 A는 디스크를 B는 프린터를 요구하면서 기다리는 현상을 말한다.

문제는 서로 A 작업과 B 작업이 종료되어야 실행을 시키는 상태에 있다면 두 프로세스는 모두 중단(Blocked or 대기(Wait)) 상태에서 벗어나지 않아 컴퓨터가 정지한 것 같은 상태가 된다.

## 데드락 원인
1. 상호 배제
2. 점유 대기
3. 비선점
4. 순환(환형) 대기

### 상호 배제 
한 프로세스가 자원을 독점하고 있으며 다른 프로세스들은 접근이 불가능하다.

> 자원을 최소 하나 이상 비공유한다.

해당 자원을 오로지 프로세스 하나만 사용할 수 있어야 한다.<br/>
사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때 까지 대기한다.

### 점유 대기
특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태다.

> 자원을 최소한 하나 정도 보유한다.

다른 프로세스에 할당된 자원을 얻으려고 대기하는 프로세스가 있어야 한다.

### 비선점
다른 프로세스의 자원을 강제적으로 가져올 수 없다.

> 자원의 선점이 불가능하다.

자원은 강제로 빼앗을 수 없고, 자원을 점유하고 있는 프로세스가 끝나야 해제된다.

### 순환(환형) 대기
프로세스 A는 프로세스 B의 자원을 요구하고, 프로세스 B는 프로세스 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황을 말한다.

### 데드락 해결 방법

> **면접을 위한 CS 전문지식 노트**

1. 자원을 할당할 때 애초에 조건이 성립되지 않도록 설계한다.
2. 데드락 가능성이 없을 때만 자원 할당이 되며, 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 '은행원 알고리즘'을 사용한다.
3. 데드락이 발생하면 사이클이 있는지 찾아보고 이에 관련된 프로세스를 한 개씩 지운다.
4. 데드락은 드문 일이기 때문에 처리하는 비용이 더 커서 데드락이 발생하면 사용자가 작업을 종료한다. 예를 들면, 응답없음이라고 떴을 때 그냥 작업을 종료하는 것처럼 말이다.

#### 은행원 알고리즘(Banker's Algorithm)
총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 또는 불안정 상태로 나누어 안정 상태로 가도록 자원을 할당하는 알고리즘이다.

> **전공 노트**

1. 예방 (Prevention)
   - 자원의 상호배제 조건 방지
   - 점유 대기 조건 방지
   - 비선점 조건 방지
   - 순환(환형)대기 조건 방지

2. 회피(Avoidance)
   - 프로세스의 시작을 중단한다. 프로세스의 요구가 교착 상태를 발생시킬 수 있다면 프로세스 시작을 중단한다.
   - 자원 할당을 거부한다. 은행원 알고리즘을 이용하여 프로세스가 요청한 자원이 데드락을 발생할 수 있다면 요청한 자원을 할당하지 않는다.

3. 탐지(Detection)과 회복(Recovery)
   - 쇼사니(Shoshani)와 코프만(Coffman)이 제안한 교착상태 탐지 알고리즘을 이용한다.
   - 회복 방법으로는 프로세스를 중단하거나, 자원을 선점하는 것이다.

### 교작상태 탐지 알고리즘(deadlock detection algorithm)
은행원 알고리즘과 유사하다.

1. Available : 자원마다 사용 가능한 자원 수를 표시하는 길이 M인 벡터
2. Allocation : 각 프로세스에 현재 할당된 각 형태의 자원 수를 표시하는 N x M 행렬
3. Request : 각 프로세스의 현재 요청을 표시하는 N x M 행렬 Request[i, j]일 때 프로세스 Pi에 필요한 자원수가 K라면 프로세스 Pi는 자원 Ri의 자원 K개 더 요청한다.

   




