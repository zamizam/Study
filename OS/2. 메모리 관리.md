# 메모리 관리
운영체제의 대표적인 역할 중 하나가 메모리 관리이다.

컴퓨터 내의 한정된 메모리를 극한으로 활용해야 하기 때문이다.

## 가상 메모리(Virtual Memory)
메모리 관리 기법의 하나로 컴퓨터가 실제로 이용 가능한 메모리 자원을 추상화하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것을 말한다.

이때 가상적으로 주어진 주소를 가상 주소(Logical Address)라고 하고, 실제 메모리상에 있는 주소를 실제 주소(Physical Address)라고 한다.

가상 주소는 메모리관리장치(MMU)에 의해 실제 주소로 변환 되며, 사용자는 실제 주소를 의식할 필요 없이 프로그램을 구축할 수 있다.

가상 메모리는 가상 주소와 실제 주소가 매핑되어 있고 프로세스의 주소 정보가 들어 있는 '페이지 테이블'로 관리 되며, 이때 TLB를 사용하여 속도를 향상 시킨다.

#### TLB
메모리와 CPU 사이에 있는 주소 변환을 위한 캐시다. 페이지 테이블에 있는 리스트를 보관하며 CPU가 페이지 테이블까지 가지 않도록 하여 속도를 향상시킬수 있는 캐시 계층이다.

## 스레싱(Thrashing)
메모리의 페이지 폴드율이 높은 것을 의미한다. 컴퓨터의 심각한 성능 저하를 초래한다.

스레싱은 메모리에 너무 많은 프로세스가 동시에 올라가게 되면서 스와핑이 많이 일어나서 발생하는 것이다.

**해결방법으로는 HDD를 SSD로 바꾸는 방법이 있다. 또는 작업 세트와 PFF가 있다.**

### 스와핑(Swapping)
가상 메모리에는 존재하지만 실제 메모리인 RAM에는 현재 없는 데이터나 코드에 접근할 경우 페이지 폴드가 발생하게 된다. 
이때 메모리에서 당장 사용하지 않는 영역을 하드디스크로 옮기려고 하드디스크의 일부분을 마치 메모리처럼 불러와 쓰는 것을 말한다.

### 페이지 폴드(Page Fault)
프로세스의 주소 공간에는 존재하지만 지금 이 컴퓨터 RAM에는 없는 데이터에 접근했을 경우 발생한다.

페이지 폴트가 일어나게 된다면, CPU 이용률이 낮아지게 되는데 이때 운영체제는 CPU가 한가하다고 생각하여 가용성을 높이기 위해 더 많은 프로세스를 메모리에 올리게 된다.
이러한 악순환이 반복이 되면 스레싱이 일어나게 된다.

***페이지 폴트로 인해 스와핑이 발생하는 과정***
1. 어떤 명령어가 유요한 가상 주소에 접근했으나 해당 페이지가 없다면 트랩이 발생되어 운영체제에게 알린다.
2. 운영체제는 실제 디스크로부터 사용하지 않는 프레임을 찾는다.
3. 해당 프레임을 실제 메모리에 가져와서 페이지 교체 알고리즘을 기반으로 특정 페이지와 교체하며 '스와핑'이 일어난다.
4. 페이지 테이블을 갱신후 해당 명령어를 다시 시작한다.

### 페이지(Page)
가상 메모리를 사용하는 최소 크기 단위

### 프레임(Frame)
실제 메모리를 사용하는 최소 크기 단위

### 작업 세트(Working Set)
프로세스의 과거 사용 이력인 지역성(Locality)을 통해 결정된 페이지 집합을 만들어 미리 메모리에 로드하는 것이다. 미리 메모리에 로드하여 탐새에 드는 비용을 줄이고 스와핑도 줄일 수 있다.

### PFF(Page Fault Frequency)
페이지 폴트 빈도를 조절하는 방법이다. 상한선과 하한선을 만들어 상한선에 도달하면 프레임을 늘리고 하한선에 도달하면 프레임을 줄이는 방식이다.
