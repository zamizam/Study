# 메모리 할당
메모리에 프로그램을 할당할 때는 시작 메모리 위치, 메모리의 할당 크기를 기반으로 할당한다.

이때 연속 할당과 불연속 할당으로 나뉜다.

## 연속 할당
연속 할당은 메모리에 연속적으로 공간을 할당하는 것을 말한다.

프로세스 A, B, C가 있다면 순차적으로 공간에 할당된다. 

이때 메모리를 미리 나누어 관리하는 고정 분할 방식과 매 시점 프로그램의 크기에 맞게 메모리를 분할하여 사용하는 가변 분할 방식으로 구분된다.

### 고정 분할 방식(Fixed Partition Allocation)
메모리를 미리 나누어 관리하는 방식이다.

메모리가 미리 나뉘어 있기 때문에 융통성이 없고, 내부 단편화가 발생한다.

### 가변 분할 방식(Variable Partition Allocation)
매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용하는 방식이다.

내부 단편화가 발생하지 않는 대신, 외부 단편화가 발생할 수 있다.

가변 분할 방식에는 3가지 종류가 있다.
1. 최초 적합 : 위쪽이나 아래쪽부터 시작해서 홀을 찾으면 할당한다.
2. 최적 적합 : 프로세스의 크기 이상인 공간 중 가장 작은 홀부터 할당한다.
3. 최악 적합 : 프로세스의 크기와 가장 많이 차이나는 홀에 할당한다.

## 불연속 할당
메모리를 연속적으로 할당하지 않는 것으로 현대의 운영체제가 불연속 할당인 '페이징 기법'을 사용한다.

메모리를 동일한 크기의 페이지로 나누어 프로그램마다 페이지 테이블을 두어 이를 통해 메모리에 프로그램을 할당한다.

그 밖에도 세그멘테이션, 페이지드 세그멘테이션이 있다.

### 페이징(Paging)
동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스를 할당한다. 홀의 크기가 균일하지 않은 문제가 없어지나, 주소 변환이 복잡해진다.

가상 메모리는 페이지로 나뉘고, 물리 메모리는 프레임으로 나뉘게 된다. 사용하지 않는 프레임을 페이지로 옮기고, 필요한 메모리를 페이지 단위로 프레임으로 옮기게 된다.

페이지 매핑(Page Mapping) 과정이 필요하여 페이지 테이블(Page TaBle)을 만든다.

불연속 할당을 하기 때문에 연속적이지 않는 공간에서도 활용이 가능하여 외부 단편화를 해결할 수 있으나, 페이지가 단위에 맞게 알맞게 딱 채워지는게 아니라 페이지와 일치하지 않는 메모리 요구 시 내부 단편화는 발생하게 된다.

### 세그멘테이션(Segmentation)
페이지 단위가 아닌 의미 단위인 세그먼트(Segment)로 나누는 방식이다.

프로세스를 이루는 메모리는 코드, 데이터, 스택, 힙 영역으로 이루어지는데 코드와 데이터로 나누거나 코드 내 작은 함수를 세그먼트로 놓고 나눌 수 있다. 

다만, 공유와 보안 측면에서는 장점이 있지만 홀 크기가 균일하지 않다는 단점이 있다. 따라서 외부 단편화가 발생할 수 있다.

### 페이지드 세그멘테이션(Paged Segmentation)
세그먼트로 나누어 공유나 보안 측면에 강점을 두고 임의의 길이가 아닌 동일한 크기의 페이지 단위로 나누는 것을 말한다. 

세그멘테이션의 문제를 보안할 수 있다면 보안할 수 있지만 내부 단편화와 외부 단편화에서 벗어난 것은 아니다.

***단편화를 회피하는 방법으로는 위에 방식 외에도 메모리 풀이 있다.***.

## 메모리 풀(Memory Pool)
필요한 메모리 공간을 필요한 크기, 갯수 만큼 사용자가 원하는 만큼 직접 지정하여 미리 할당받아 사용하고 반납하는 기법이다.

메모리 풀없이 동적 할당과 해제를 반복하면 메모리의 랜덤한 위치에 할당과 해제가 반복되어 단편화가 발생할 수 있다. 

따라서, 미리 공간을 할당하고 가져다 쓰고 반납하면 할당과 해제로 인한 외부 단편화를 막을 수 있다.

또한, 필요한 크기만큼 할당하기 때문에 내부 단편화도 막을 수 있다.

하지만, 메모리 낭비량보다 메모리 풀을 만들어 놓고 사용하지 않는 메모리의 양이 더 크다면 사용을 하지 않는 편이 좋으며 미리 할당해놓고 사용하지 않는 순간에도 할당해놓는다면 메모리 누수가 있다.

## 단편화(Fragmentation)
사용 가능한 메모리가 충분하지만 사용할 수 없는 상태이다.

즉, RAM에서 메모리의 공간이 작은 조각으로 나뉘어져 사용 가능한 메모리가 충분히 존재하지만 할당(사용)이 불가능한 상태를 '메모리 단편화'가 발생했다고 한다.

#### 내부 단편화(Internal Fragmentation)
메모리를 나눈 크기보다 프로그램이 작아서 들어가지 못하는 공간이 발생하는 현상이다.

예를 들면, 100MB만큼 할당했는데 프로그램 크기가 30MB라면, 70MB의 내부 단편화가 발생한다.

#### 외부 단편화(External Fragmentation)
메모리를 나눈 크기보다 프로그램이 커서 들어가지 못하는 공간이 많이 발생하는 현상을 말한다.

예를 들면, 100MB를 55MB와 45MB로 나눠 프로그램 크기가 70MB여서 들어가지 못하여 메모리에 여유가 생긴 것을 외부 단편화라고 한다.

#### 홀(Hole)
할당할 수 있는 비어있는 메모리 공간을 말한다.

