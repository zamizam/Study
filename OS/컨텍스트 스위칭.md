# 컨텍스트 스위칭(Context Switching)
PCB를 기반으로 프로세스의 상태를 저장하고 로드시키는 과정을 말한다. 한 프로세스에 할당된 시간이 끝나거나 인터럽트에 의해 발생한다.

컴퓨터는 많은 프로그램을 동시에 실행하는 것처럼 보이지만 어떠한 시점에서 실행되고 있는 프로세스는 단 한 개 뿐이다. 
많은 프로세스가 동시에 구동되는 것 처럼 보이지만 다른 프로세스와 컨텍스트 스위칭이 빠른 속도로 실행되고 있는 것이다.

> 물론, 멀티코어의 CPU의 경우, 한 시점에 한개의 프로그램이라는 것은 아니다. 컨텍스트 스위칭을 설명할 때에는 '싱글코어'라는 기준으로 설명해야 한다.

<p align="center"><img src=https://github.com/zamizam/Study/assets/162006818/e4f84364-93a4-4550-b4af-26b9404fcedc width="500" height="500"></p>

컨텍스트 스위칭은 한 개의 프로세스 A가 실행하다 멈추면 프로세스 A가 PCB를 저장하고 다시 프로세스 B를 로드하여 실행한다. <br/>
그리고 다시 프로세스 B의 PCB를 저장하고 프로세스 A를 PCB에 로드한다.

컨텍스트 스위칭이 일어날 때에는 ***유휴시간(Idle Time)이 발생***하게 된다. 뿐만 아니라, ***[캐시미스]***(https://github.com/zamizam/Study/blob/main/OS/%EC%BA%90%EC%8B%9C%ED%9E%88%ED%8A%B8%EC%99%80%20%EC%BA%90%EC%8B%9C%EB%AF%B8%EC%8A%A4.md)라는 비용이 추가로 발생한다.

> **캐시미스** <br/>
컨텍스트 스위칭이 일어날 때 프로세스가 가지고 있는 메모리 주소가 그대로 있으면 잘못된 주소 변환이 생기기 때문에 그러지 않도록 캐시 클리어 과정을 겪는다.
따라서 캐시미스가 발생한다.

> **스레드에서 컨텍스트 스위칭** <br/>
스레드에서도 컨텍스트 스위칭이 일어나는데, 스레드는 스택 영역을 제외한 모든 메모리를 공유하기 때문에 스레드 컨텍스트 스위칭의 경우 비용이 적고 시간도 적게 걸린다.

## PCB(Process Control Block)
운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터를 말한다. 프로세스 제어 블록이라고도 한다.

프로세스가 생성되면 운영체제는 해당 PCB를 생성하게 된다. 프로그램이 실행되면 프로세스가 생성되고 프로세스 주소 값들이 스택, 힙 등 각 메모리 구조를 기반으로 할당된다.

이 프로세스의 메타데이터들이 PCB에 저장되어 관리되는데, 프로세스의 중요한 정보를 포함하고 있기 때문에 일반 사용자가 접근하지 못하도록 커널 스택의 가장 앞부분에서 관리된다.

### 메타데이터(Metadata)
데이터에 관한 구조화된 데이터이자, 데이터를 설명하는 작은 데이터이다. 대량의 정보 가운데 찾고 있는 정보를 효율적으로 찾아내서 이용하기 위해 일정한 규칙에 따라 콘텐츠에 대해 부여되는 데이터다.

## PCB 구조
- 프로세스 스케줄링 상태 : '준비', '일시중단' 등 프로세스가 CPU에 대한 소유권을 얻은 이후의 상태
- 프로세스 ID : 프로세스 ID and 해당 프로세스의 자식 프로세스 ID
- 프로세스 권한 : 컴퓨터 자원 or I/O 디바이스에 대한 권한 정보
- 프로그램 카운터 : 프로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터
- CPU 레지스터 : 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
- CPU 스케줄링 정보 : CPU 스케줄러에 의해 중단된 시간 등에 대한 정보
- 계정 정보 : 프로세스 실행에 사용된 CPU 사용량 and 실행한 유저의 정보
- I/O 상태 정보 : 프로세스에 할당된 I/O 디바이스 목록
